gThis=function(){return this}(),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),Function.prototype.arg=function(){if("function"!=typeof this)throw new TypeError("Function.prototype.arg needs to be called on a function");var a=Array.prototype.slice,b=a.call(arguments),c=this,d=function(){return c.apply(this,b.concat(a.call(arguments)))};return d.prototype=Object.create(this.prototype),d},RegExp.quote=function(a){return(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},Date.prototype.stdTimezoneOffset=function(){var a=new Date(this.getFullYear(),0,1),b=new Date(this.getFullYear(),6,1);return Math.max(a.getTimezoneOffset(),b.getTimezoneOffset())},Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()},$.json=function(a){var b={contentType:"application/json",dataType:"json",method:"POST"};a.data&&"string"!=typeof a.data&&(a.data=JSON.stringify(a.data));for(var c in b)"undefined"==typeof a[c]&&(a[c]=b[c]);return $.ajax(a)},$.file=function(a,b){var c=new FormData;a.data&&c.append("_json",JSON.stringify(a.data)),b.map(function(a,b){c.append($(a).attr("name"),a.files[0])}),a.url=a.url||window.location;var d=new XMLHttpRequest;return a.progress&&d.upload.addEventListener("progress",a.progress,!1),a.success&&d.addEventListener("load",function(b){a.success(JSON.parse(b.target.responseText))},!1),a.error&&d.addEventListener("error",a.progress,!1),d.open("POST",a.url),d.send(c),d},$.eachApply=function(a,b){$(a).each(b)},bf=bf||{},bf.tool=function(){},bf.setCookie=function(a,b,c){var d=a+"="+escape(b)+";path=/;";if(c){var e=new Date;e.setTime(e.getTime()+c),d+="expires="+e.toGMTString()}document.cookie=d},bf.readCookie=function(a){for(var a=a+"=",b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null},bf.arrays={},bf.arrays.vInA=function(a,b){var c;for(c in b)if(b[c]==a)return!0;return!1},bf.arrays.rmV=function(a,b){var c;for(c in b)b[c]==a&&unset(b[c])},bf.arrays.addUnique=function(a,b){bf.arrays.vInA(a,b)||(b[b.length]=a)},bf.arrays.firstAvailableKey=function(a){for(var b=0;b<a.length;b++)if("undefined"==typeof a[b])return b;return a.length},bf.arrays.onAvailable=function(a,b){var c=bf.arrays.firstAvailableKey(b);return b[c]=a,c},bf.arrays.firstKey=function(a){for(var b=0;b<a.length;b++)if("undefined"!=typeof a[b])return b;return!1},bf.arrays.firstValue=function(a){var b=bf.arrays.firstKey(a);return a[b]},bf.arrays.count=function(a){count=0;for(var b in a)count+=1;return count},bf.obj={},bf.obj.setValue=function(a,b,c){nameParts=a.replace(/\]/g,"").split(/\[/),current=c;for(var d=0;d<nameParts.length-1;d++)current[nameParts[d]]||(current[nameParts[d]]={}),current=current[nameParts[d]];current[nameParts[nameParts.length-1]]=b},_.extend=function(a){for(var b,c=0;c<arguments.length;c++)for(b in arguments[c])a[b]=arguments[c][b];return a},bf.url={},bf.url.requestVar=function(a,b){if(b=null!=b?b:!0,url=window.location+"",/\?/.test(url)){var c=url.split("?");regexName=a.replace(/(\[|\])/g,"\\$1");var d=new RegExp("(^|&)"+regexName+"=(.*?)(&|$)","g"),e=d.exec(c[1]);if(e)return b?decodeURIComponent(e[2]):e[2]}return!1},bf.url["default"]=function(a){return a=null!=a?a:window.location,a+=""},bf.url.parts=function(a,b){b=null!=b?b:!0,a=bf.url["default"](a);var c=[],d=a.split("?");if(d[1]){var e=d[1].split("&");if(e.length>0)for(var f in e){var g=e[f],h=g.split("=");b&&(h[0]=decodeURIComponent(h[0]),h[1]=decodeURIComponent(h[1])),c.push(h)}}return{page:d[0],pairs:c}},bf.url.fromParts=function(a,b){if(b=null!=b?b:!0,url=a.page,a.pairs.length>0){var c=[];for(var d in a.pairs){var e=a.pairs[d];b&&(e[0]=encodeURIComponent(e[0]),e[1]=encodeURIComponent(e[1])),c.push(e[0]+"="+e[1])}query=c.join("&"),url=url+"?"+query}return url},bf.url.queryFilter=function(a,b,c){var d=bf.url.parts(b,c);if(a.constructor!=RegExp&&(a=a.constructor==String?new RegExp("^"+RegExp.quote(a)+"$","g"):new RegExp(".*","g")),d.pairs.length>0){var e=[];for(var f in d.pairs){var g=d.pairs[f];g[0].match(a)||e.push(g)}d.pairs=e}return bf.url.fromParts(d,c)},bf.url.append=function(a,b,c,d){d=null!=d?d:!1,d&&(c=bf.url.queryFilter(a,c));var e=bf.url.parts(c);return e.pairs.push([a,b]),bf.url.fromParts(e)},bf.url.appends=function(a,b,c){var d,e;for(var f in a)"object"==typeof a[f]?(d=a[f][0],e=a[f][1]):(d=f,e=a[f]),b=bf.url.append(d,e,b,c);return b},bf.bindec=function(a){a=(a+"").split("").reverse();for(var b=0,c=0;c<a.length;c++)1==a[c]&&(b+=Math.pow(2,c));return b},bf.decbin=function(a){for(var b="",c=a;c>=1;c=Math.floor(c/2))b+=c%2;var d=Math.ceil(c);return d&&(b+=d),b.split("").reverse().join("")},bf.toInt=function(a){return"string"==typeof a?(a=a.replace(/[^0-9]+/g," "),a=a.replace(/^ +/g,""),a=a.replace(/^0+/g,""),a=a.split(" "),num=parseInt(a[0])):num=parseInt(a),isNaN(num)?0:num},bf.math={},bf.math.round=function(a,b){var c=new Number(bf.str.pad(1,b+1,"0","right"));return Math.round(a*c)/c},bf.str=function(a){return"number"==typeof a?a+"":a?a:""},bf.str.pad=function(a,b,c,d){if(a=new String(a),c||(c="0"),d||(d="left"),"left"==d)for(;a.length<b;)a=c+a;else for(;a.length<b;)a+=c;return a},bf.str.ucwords=function(a){if(a){a=a.split(" ");var b=Array();return $.each(a,function(){b[b.length]=this.substr(0,1).toUpperCase()+this.substr(1,this.length)}),b.join(" ")}},bf.str.capitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},bf.str.hsc=function(a){return null===a?"":$("<a></a>").text(a).html()},bf.str.nl2br=function(a){return a.replace(/(?:\r\n|\r|\n)/g,"<br />")},bf.toggle=function(a,b){return a==b[0]?b[1]:b[0]},bf.logError=function(a){console.log(a),console.log(bf.debug.backtrace())},bf.model={},bf.modelPromise=function(a){"string"==typeof a&&(a=[a]);var b=[];for(var c in a){var d=a[c];bf.model[d]&&bf.model[d].loaded||b.push(bf.modelLoad(d))}return Q.all(b)["catch"](bf.logError)},bf.modelLoadCallbacks={},bf.modelLoad=function(a){return Q.Promise(function(b,c,d){$.get("/brushfire/model?table="+a,function(c){var d=[a];for(var e in c)bf.model[e]&&bf.model[e].loaded||(bf.model[e]=c[e],c[e].loaded&&d.push(e));bf.model[a]?bf.model[a].loaded=!0:console.log("Loaded model does not include requests table",a,c);for(var f in d)bf.modelLoadCallbacks[d[f]]&&bf.modelLoadCallbacks[d[f]]();b()})})},bf.hashFnv32a=function(a,b){var c,d,e=void 0===b?2166136261:b;for(c=0,d=a.length;d>c;c++)e^=a.charCodeAt(c),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return("0000000"+(e>>>0).toString(16)).substr(-8)},bf.modelData={},bf.modelDataPromises={},bf.loadData=function(a,b,c){c=c||{};var d=JSON.stringify(b),e=bf.hashFnv32a(d);return!c.noCache&&bf.modelDataPromises[e]?bf.modelDataPromises[e]:(bf.modelDataPromises[e]=Q.Promise(function(d,f,g){c={url:"/model/"+a,data:b,success:function(a){bf.modelData[e]=a.value,d(bf.modelData[e])}},$.json(c)}),bf.modelDataPromises[e])},bf.modelFields={},bf.getModelField=function(a,b){var c=bf.parseModelFieldName(a,b),d=b+"."+c.relative;if(bf.modelFields[d])return bf.modelFields[d];var e=bf.model[c.scope].columns[c.relative]||{};if(e=JSON.parse(JSON.stringify(e)),e.name=_.extend(c,e.name||{}),e.name.scope!=b){var f=bf.model[b].extendedColumns;if(f&&f[e.name.relative])e.name.display=f[e.name.relative].display;else{var g,h=e.name.relative.match(/__(.*$)/);h&&(g=h[1]),e.name.display=(e.name.scope+" "+e.name.field).split("_").map(bf.str.capitalize).join(" "),g&&(e.name.display=e.display+" "+g)}}if(!e.name.display){var i=e.name.relative.split("_");i=i.map(bf.str.capitalize),e.name.display=i.join(" ")}return bf.modelFields[d]=e,e},bf.parseModelFieldName=function(a,b){var c={},d=a.split(".");if(1==d.length)c.field=d[0],c.relative=c.field,c.scope=b;else if(b&&d[0]!=b){var e=bf.model[b].links.dc[d[0]];c.relative=a,c.scope=e.ft,c.field=d[1]}else c.relative=a,c.scope=d[0],c.field=d[1];return c.absolute=c.scope+"."+c.field,c},bf.run=function(a){var b=[];for(var c in a)b.push(a[c]());return b},bf.debug={},bf.debug.backtrace=function(a){if(a=a?a.caller:arguments.callee.caller,!a)return"";var b=bf.debug.functionName(a);b="(";var c=[];for(var d in a.arguments)bf.arrays.add(a.arguments.toString(),c);return b+="("+c.join(",")+")\n",b+bf.debug.backtrace(a)},bf.debug.functionName=function(a){var b=/\W*function\s+([\w\$]+)\(/.exec(a);return b?b[1]:"No name"},bf.view={},bf.view.windows={},bf.view.redirect=function(a,b,c){return b&&bf.view.windows[b]&&!bf.view.windows[b].closed?(bf.view.windows[b].bf.view.redirect(a),!1):b?("window"==c?bf.view.windows[b]=window.open(a,b,newWindow):bf.view.windows[b]=window.open(a,b),!1):"tab"==c?window.open(a,"_blank"):"window"==c?window.open(a,null,newWindow):("number"==typeof a?0==a?window.location.reload(!1):history.go(a):a?window.location=a:window.location=window.location+"",!1)},bf.view.ps={},bf.view.ps.start=function(a){defaults={url:window.location,pagingControl:$("#pagingControl"),page:0,pages:0,sorts:""};for(var b in defaults)"undefined"==typeof a[b]&&(a[b]=defaults[b]);bf.view.ps.makePageControl(a),bf.view.ps.get(a,{page:1})},bf.view.ps.get=function(a,b){var c=!1;b.page&&a.page!=b.page&&(a.page=b.page,c=!0),b.sort&&a.sort!=b.sort&&(a.sort=b.sort,c=!0),c&&$.ajax({url:a.url,contentType:"application/json",data:JSON.stringify(a),dataType:"json",method:"POST",success:function(b){a.pages=b.value.info.pages,bf.view.ps.apply(b.value.rows,a)}})},bf.view.ps.parseSort=function(a){var b,c=a.substring(0,1);return"-"!=c&&"+"!=c?(c="+",b=a):b=a.substring(1),{order:c,field:b}},bf.view.ps.headerArrows=function(){var a,b;for(var c in bf.sorts)a=bf.view.ps.parseSort(bf.sorts[c]),b=$('.sortContainer [data-field="'+a.field+'"]'),"+"==a.order?b.addClass("sortAsc"):b.addClass("sortDesc")},bf.view.ps.appendSort=function(a){var b;for(var c in bf.sorts)if(b=bf.view.ps.parseSort(bf.sorts[c]),a==b.field)return b.order=bf.toggle(b.order,["+","-"]),void(bf.sorts[c]=b.order+b.field);bf.sorts.push("+"+a)},bf.view.ps.changeSort=function(a){var b;for(var c in bf.sorts)if(b=bf.view.ps.parseSort(bf.sorts[c]),a==b.field)return b.order=bf.toggle(b.order,["+","-"]),void(bf.sorts=[b.order+b.field]);bf.sorts=["+"+a]},bf.view.ps.apply=function(a,b){b.handlers.dataHandler(a,b),bf.view.ps.makePageControl(b)},bf.view.ps.makePageControl=function(a){if(a.pages&&!(a.pages<2)){if(a.pages=parseInt(a.pages),a.page=parseInt(a.page),!a.pagingControl.hasClass("pagingControl")){var b=$(".pagingControl",a.pagingControl);b.size()||(b=$('<div class="pagingControl"></div>'),a.pagingControl.append(b)),a.pagingControl=b}var c=$(".paginater",a.pagingControl);c.size()||(c=$("<div class='paginater'></div>"),a.pagingControl.append(c)),c.html("");var d=2,e=Math.max(a.page-d,1),f=Math.min(a.page+d,a.pages),g=d-(a.page-e);g?f=Math.min(f+g,a.pages):(g=d-(f-a.page),g&&(e=Math.max(e-g,1))),1!=a.page&&c.append('<div class="clk first">&lt;&lt;</div><div class="clk prev">&nbsp;&lt;&nbsp;</div>');for(var h=e;f>=h;h++){var i=h==a.page?" current":"";c.append('<div class="clk pg'+i+'">'+h+"</div>")}a.page!=a.pages&&c.append('<div class="clk next">&nbsp;&gt;&nbsp;</div><div class="clk last">&gt;&gt;</div>'),c.append("<div class='direct'>				<input title='Total of "+a.pages+"' type='text' name='directPg' value='"+a.page+"'/>				<div class='clk go'>Go</div>			</div>"),$(".clk:not(.disabled)",c).click(function(b){var c,d=$(this);if(d.hasClass("pg"))c=d.text();else if(d.hasClass("next"))c=a.page+1;else if(d.hasClass("last"))c=a.pages;else if(d.hasClass("first"))c=1;else if(d.hasClass("prev"))c=a.page-1;else if(d.hasClass("go")){var e=d.parents(".paginater");c=Math.abs($("input",e).val())}bf.view.ps.get(a,{page:c})}),$("input",c).keypress(function(a){13==a.which&&(a.preventDefault(),$(".go",c).click())})}},bf.view.sm={},bf.view.sm.defaults=function(a){if(a=a||{},a.context?a.context=bf.view.sm.firstContext(a.context):a.context=$("body"),!a.messageContainer)for(var b=a.context;!a.messageContainer&&(a.messageContainer=$("._messageContainer:first",b),!a.messageContainer.size());)if(b=b.parents("[data-context]:first"),!b.size()){console.log("No Message Container"),console.log(a);break}return a},bf.view.sm.firstContext=function(a){if(a.attr("data-context"))return a;var b=a.parents("[data-context]:first");return b.size()?b:(console.log("No data context found"),a)},bf.view.sm.redirect=function(a,b){bf.view.redirect(bf.url.append("_systemMessages",JSON.stringify(a),b,!0))},bf.view.sm.parse=function(a,b){titles=[];for(var c in a.fields)titles.push(bf.view.sm.title(a.fields[c],b));if(1==a.fields.length){var d=titles.join(",");a.content=a.content.replace(/\{_FIELD_\}/g,'"'+d+'"')}return a.itemOffset&&(a.content+=" (item "+a.itemOffset+")"),a},bf.view.sm.title=function(a,b){for(;;){if(b.map&&b.map[a]){title=b.map[a];break}var c=$('[data-field="'+a+'"][data-title]',b.context);if(c.size()){title=c.text();break}if(c=$('[name="'+a+'"][data-title]',b.context),c.size()){title=c.attr("data-title");break}if(c=$('[for="'+a+'"]',b.context),c.size()){title=c.text();break}if($('[name="'+a+'"][placeholder]',b.context).size()){title=$('[name="'+a+'"][placeholder]',b.context).attr("placeholder");break}title=a;break}return title},bf.view.sm.highlight=function(a,b){if(a.fields.length>0)for(var c in a.fields){var d,e=a.fields[c];if(a.itemOffset){var f=a.itemOffset+"-"+e;d=$('[data-field="'+f+'"][data-container]',b.context),d.size()||(d=$('[name="'+f+'"]',b.context))}d&&d.size()||(d=$('[data-field="'+e+'"][data-container]',b.context),d.size()||(d=$('[name="'+e+'"]',b.context))),d.size()&&d.addClass("_"+a.type+"Highlight")}},bf.view.sm.unhighlight=function(a){var b=["error","success","notice","warning"];for(var c in b){var d="_"+b[c]+"Highlight";$("."+d,a.context).removeClass(d)}},bf.view.sm.insert=function(a,b){"string"==typeof a&&(3==arguments.length?(b=arguments[2],a={type:arguments[1],content:arguments[0]}):2==arguments.length?(a={type:arguments[1],content:arguments[0]},b=!1):a={type:"notice",content:arguments[0]}),b=bf.view.sm.defaults(b),a.fields=a.fields||[],"error"==a.type&&b.context.attr("data-hasError",!0),a=bf.view.sm.parse(a,b);var c;if(bf.view.sm.highlight(a,b),a.content){var d=$('<div data-fields="'+JSON.stringify(a.fields)+'" data-'+a.type+'Message class="_message _'+a.type+'"></div>').html(a.content);1==a.fields.length&&(c=a.fields[0]);var e;if(c&&(potentialContainer=$('._messageContainer[data-field="'+c+'"]',b.context),potentialContainer.size()?e=potentialContainer:(potentialContainer=$('._messageContainer[data-field="'+c+'"]',b.context),potentialContainer.size()&&(e=potentialContainer))),e=e||b.messageContainer,d.hide().appendTo(e).fadeIn({duration:"slow"}),(a.expiry||a.closeable)&&bf.view.closeButton(d),a.expiry){var f;f=a.expiry<86400?1e3*a.expiry:a.expiry-(new Date).getTime()/1e3,setTimeout(function(a,b){a.fadeOut(b)}.bind(null,d,{duration:"slow",complete:function(){$(this).remove()}}),f)}}},bf.view.sm.inserts=function(a,b){b=b||{};for(var c in a)bf.view.sm.insert(a[c],b)},bf.view.sm.insertsWithOffsets=function(a,b){for(var c in a){var d=a[c];if(d.itemOffset){options={};var e=$('[data-context][data-itemOffset="'+d.itemOffset+'"]',b);e.size()||(e=b),options.context=b;var f=$("._messageContainer",b);f.size()&&(options.messageContainer=f),bf.view.sm.insert(a[c],options)}else bf.view.sm.insert(d,{context:b})}},bf.view.sm.uninserts=function(a){a=bf.view.sm.defaults(a),bf.view.hasError=!1,bf.view.sm.unhighlight(a),a.messageContainer.empty()},bf.view.closeButton=function(a,b){var c=$('<div class="_closeButton"></div>');a.prepend(c),b?c.click(function(){$(this).parent().fadeOut()}):c.click(function(){$(this).parent().fadeOut({complete:function(){$(this).parent().remove()}})})},bf.view.form={},bf.view.form.getCsrf=function(a){var b=bf.view.form.response.arg({success:function(b){a(b.value)}});$.json({url:"/brushfire/csrf",success:b})},bf.view.form.addCsrf=function(a){bf.view.form.getCsrf(function(b){a.append($('<input type="hidden" name="_csrfToken"/>').val(b))})},bf.view.form.datas=function(a){return data={},$("form",a).each(function(a){var b=$(this).attr("data-itemOffset");b=b||a,data[a]=bf.view.form.data($(this))}),data},bf.view.form.data=function(a){var b={};return $("[name]:not([data-noPost])",a).each(function(){var a=$(this).attr("name");"checkbox"==$(this).attr("type")?bf.obj.setValue(a,$(this).prop("checked"),b):bf.obj.setValue(a,$(this).val(),b)}),b},bf.view.form.model=function(a){if(a=a||{},!a.fieldNames){if(!a.scope)throw"No field names and no scope on makeModelForm call";a.fieldNames=Object.keys(bf.model[a.scope].columns)}!a.submitText&&a.type&&(a.submitText=bf.str.capitalize(a.type)),a.values=a.values||bf.json.value||{};var b=[],c=$('<form action="" method="post"></form>').attr("data-scope",a.scope);a.type&&c.attr("data-changeType",a.type);var d=a.namePrefix||"";"undefined"!=typeof a.itemOffset&&(c.attr("data-itemOffset",a.itemOffset),d=a.itemOffset+"-"+d);for(var e in a.fieldNames){var f=bf.getModelField(a.fieldNames[e],a.scope),g=a.values[f.name.relative],h={namePrefix:d},i=bf.view.form.getLine(f,g,h);f.nameLink&&(i.attr("data-specialLinkFt",f.nameLink.ft),b.push({table:f.nameLink.ft,nullable:f.nullable,"default":f["default"],field:f.name.relative,context:c})),c.append(i)}if(b.length>0)for(var j in b){var k=bf.view.form.namedIdField.arg(b[j]),l={type:"readMany",sort:"+name",select:["id","name"]};bf.loadData(b[j].table,l).then(k)}return a.submitText&&c.append($('<div class="fieldContainer submit"><div class="submit"><input type="submit" name="submit" value="'+a.submitText+'" /></div>')),a.parent&&(a.parent.append(c),bf.run(bf.view.updateHooks)),c},bf.view.form.namedIdField=function(a,b){var c=$("<select></select>");for(var d in b)row=b[d],c.append($('<option value="'+row.id+'"></option>').text(row.name));a["default"]?c.val(a["default"]):a.nullable&&c.append($('<option value="">Default</option>'));var e=$('[name="'+a.field+'"]',a.context);attributes=e.get(0).attributes;for(var d in attributes)c.attr(attributes[d].nodeName,attributes[d].nodeValue);e.replaceWith(c)},bf.view.form.fillInputs=function(a,b){$('[name]:not([type="submit"])',a).each(function(){bf.view.form.fillInput($(this),b[$(this).attr("name")])})},bf.view.form.fillInput=function(a,b){"checkbox"==a.attr("type")?b&&"0"!=b&&a.prop("checked",!0):a.val(b||"")},bf.view.form.getLine=function(a,b,c){c=c||{};var d,e=$('<div class="fieldContainer" data-forField="'+a.name.relative+'"></div>');a.description=a.description||a.name.display;var f=$("<label></label>").html(a.description);a.inputType||("text"==a.type?!a.limit||a.limit>100?a.inputType="textarea":a.inputType="text":"int"==a.type||"float"==a.type||"decimal"==a.type?1==a.limit?a.inputType="checkbox":a.inputType="number":"date"==a.type?a.inputType="date":"datetime"==a.type?a.inputType="datetime":(a.inputType="text",console.log("unknown field type: "+a.type,a))),"checkbox"==a.inputType?d=$('<input type="checkbox" value=1 />'):"textarea"==a.inputType?d=$("<textarea></textarea>"):"div"==a.inputType?d=$("<div></div>"):"hidden"==a.inputType?(e.css({display:"none"}),d=$('<input type="'+a.inputType+'"/>')):d=$('<input type="'+a.inputType+'"/>'),("float"==a.type||"decimal"==a.type)&&d.attr("step","any"),bf.view.form.fillInput(d,b);var g=a.name.relative;if(d.attr("data-fieldPrefix",c.namePrefix||""),c.namePrefix&&(g=c.namePrefix+g),d.attr("name",g),d.attr("data-field",a.name.relative),d.attr("data-fieldAbsolute",a.name.absolute),a.limit&&d.attr("maxlength",a.limit),a.name.display&&d.attr("placeholder",a.name.display),c.inputAttributes)for(var h in c.inputAttributes)d.attr(h,c.inputAttributes[h]);return e.append(f).append($('<div class="input"></div>').append(d))},bf.view.form.submit=function(a){var b=$(this);bf.view.sm.uninserts({context:b});var c={item:bf.view.form.data(b),type:b.attr("data-changeType")};success=bf.view.form.response.arg({context:b,success:a.success});var d=$('input[type="file"]',b);return d.size()?$.file({success:success,data:c,url:a.url},d.toArray()):$.json({success:success,data:c,url:a.url}),!1},bf.view.form.submits=function(a,b){var c;bf.view.sm.uninserts({context:a});var d={items:{}};return $("form",a).each(function(){var a=$(this);c=a.attr("data-changeType");var b=a.attr("data-itemOffset");d.items[b]=bf.view.form.data(a)}),d.type=c,b=bf.view.form.response.arg({context:a,success:b}),$.json({success:b,data:d}),!1},bf.view.form.response=function(a,b){1==b.status?"object"==typeof success?bf.view.sm.insertsWithOffsets(a.success,a.context):"function"==typeof a.success?a.success(b):bf.view.sm.insert({type:"success",content:a.success},{context:a.context}):bf.view.sm.insertsWithOffsets(b.messages,a.context)},bf.view.updateHooks=[],bf.view.enterSubmit=function(a){$("input",a).keypress(function(a){13==a.which&&$(this).submit()})},bf.view.ele={},bf.view.ele.firstParse=function(a,b){return b="data-"+b,$(a).attr(b+"-parsed")?!1:($(a).attr(b+"-parsed","1"),$(a).attr(b))},bf.view.ele["delete"]=function(){var a=bf.view.ele.firstParse(this,"deleteUrl");a!==!1&&($(this).css({cursor:"pointer"}),$(this).click(function(b){if(b.preventDefault(),confirm("Are you sure you want to delete this?")){var c=a||window.location;$.json({url:c,data:{_delete:1},success:bf.view.ajaxFormResponse.arg(function(a){a.redirect&&(window.location=a.redirect),a.messages?bf.view.sm.inserts(a.messages):bf.view.sm.insert({type:"success",content:"Deleted"})})})}}))},bf.view.ele.timeFormat=function(){var a=bf.view.ele.firstParse(this,"timeFormat");if(a!==!1){var b=bf.date.strtotime($(this).text());$(this).text(bf.date.format(a,b))}},bf.view.ele.utcFormat=function(){var a=bf.view.ele.firstParse(this,"utcFormat");if(a!==!1){var b=!1,c=$(this).text();c||(c=$(this).val(),b=!0);var d=bf.date.utcToUnix(c);a||(a="date"==$(this).attr("type")?"Y-m-d":"Y-m-d H:i:s"),d=bf.date.format(a,d),b?$(this).val(d):$(this).text(d)}},bf.view.ele.timeAgo=function(){var a=bf.view.ele.firstParse(this,"timeAgo");if(a!==!1){a=JSON.parse(a?a:"{}");var b=bf.date.strtotime($(this).text());$(this).text(bf.date.timeAgo(b,a.round,a.type))}},bf.view.ele.redirect=function(){var a=bf.view.ele.firstParse(this,"redirect");a!==!1&&$(this).css({cursor:"pointer"}).mousedown(bf.view.clickRedirect.arg(a))},bf.view.clickRedirect=function(a,b){b.preventDefault(),2==b.which?bf.view.redirect(a,null,"tab"):1==b.which&&($(this).attr("data-newTab")?bf.view.redirect(a,null,"tab"):window.location=a)},bf.date={},bf.date.format=function(a,b){"string"==typeof b&&(b=parseInt(b)),a=a?a:"Y-m-d";var c=this,d="undefined"==typeof b?new Date:"number"==typeof b?new Date(1e3*b):new Date(b),e=function(a,b){return(a+="").length<b?new Array(++b-a.length).join("0")+a:a},f=function(a){var b=0,c=new Date(a.getFullYear(),0,1,0,0,0,0),d=new Date(a.getFullYear(),6,1,0,0,0,0),e=c.toUTCString(),f=new Date(e.slice(0,e.lastIndexOf(" ")-1)),e=d.toUTCString(),g=new Date(e.slice(0,e.lastIndexOf(" ")-1)),h=(c-f)/36e5,i=(d-g)/36e5;if(alert(i),h===i)b=0;else{var j=h-i;j>=0&&(h=i),b=1}return b},g="",h=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i={1:"st",2:"nd",3:"rd",21:"st",22:"nd",23:"rd",31:"st"},j=["","January","February","March","April","May","June","July","August","September","October","November","December"],k={d:function(){return e(k.j(),2)},D:function(){var a=k.l();return a.substr(0,3)},j:function(){return d.getDate()},l:function(){return h[k.w()]},N:function(){return k.w()?k.w():7},S:function(){return i[k.j()]?i[k.j()]:"th"},w:function(){return d.getDay()},z:function(){return(d-new Date(d.getFullYear()+"/1/1"))/864e5>>0},W:function(){var a,b=k.z(),e=364+k.L()-b,f=(new Date(d.getFullYear()+"/1/1").getDay()||7)-1;if(2>=e&&(d.getDay()||7)-1<=2-e)return 1;if(2>=b&&f>=4&&b>=6-f)return a=new Date(d.getFullYear()-1+"/12/31"),c.date("W",Math.round(a.getTime()/1e3));var g=1+(3>=f?(b+f)/7:(b-(7-f))/7)>>0;return g?g:53},F:function(){return j[k.n()]},m:function(){return e(k.n(),2)},M:function(){var a=k.F();return a.substr(0,3)},n:function(){return d.getMonth()+1},t:function(){var a;return 2==(a=d.getMonth()+1)?28+k.L():1&a&&8>a||!(1&a)&&a>7?31:30},L:function(){var a=k.Y();return 3&a||!(a%100)&&a%400?0:1},o:function(){return 12===k.n()&&1===k.W()?d.getFullYear()+1:1===k.n()&&k.W()>=52?d.getFullYear()-1:d.getFullYear()},Y:function(){return d.getFullYear()},y:function(){return(d.getFullYear()+"").slice(2)},a:function(){return d.getHours()>11?"pm":"am"},A:function(){return k.a().toUpperCase()},B:function(){var a=60*(d.getTimezoneOffset()+60),b=3600*d.getHours()+60*d.getMinutes()+d.getSeconds()+a,c=Math.floor(b/86.4);return c>1e3&&(c-=1e3),0>c&&(c+=1e3),1==String(c).length&&(c="00"+c),2==String(c).length&&(c="0"+c),c},g:function(){return d.getHours()%12||12},G:function(){return d.getHours()},h:function(){return e(k.g(),2)},H:function(){return e(d.getHours(),2)},i:function(){return e(d.getMinutes(),2)},s:function(){return e(d.getSeconds(),2)},u:function(){return e(1e3*d.getMilliseconds(),6)},e:function(){return"UTC"},I:function(){return f(d)},O:function(){var a=e(Math.abs(d.getTimezoneOffset()/60*100),4);return a=d.getTimezoneOffset()>0?"-"+a:"+"+a},P:function(){var a=k.O();return a.substr(0,3)+":"+a.substr(3,2)},T:function(){return"UTC"},Z:function(){return 60*-d.getTimezoneOffset()},c:function(){return k.Y()+"-"+k.m()+"-"+k.d()+"T"+k.h()+":"+k.i()+":"+k.s()+k.P()},r:function(){return k.D()+", "+k.d()+" "+k.M()+" "+k.Y()+" "+k.H()+":"+k.i()+":"+k.s()+" "+k.O()},U:function(){return Math.round(d.getTime()/1e3)}};return a.replace(/[\\]?([a-zA-Z])/g,function(a,b){return g=a!=b?b:k[b]?k[b]():b})},bf.date.strtotime=function(a,b){var c=parseInt(a);if(c==a)return c.toString().length>12?parseInt(c/1e3):c;a+="";var d,e,f,g="",h="";if(g=a,g=g.replace(/\s{2,}|^\s|\s$/g," "),g=g.replace(/[\t\r\n]/g,""),"now"==g)return(new Date).getTime()/1e3;if(!isNaN(h=Date.parse(g)))return h/1e3;b=b?new Date(1e3*b):new Date,g=g.toLowerCase();var i={day:{sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},mon:{jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}},j=function(a){var c=a[2]&&"ago"==a[2],d=(d="last"==a[0]?-1:1)*(c?-1:1);switch(a[0]){case"last":case"next":switch(a[1].substring(0,3)){case"yea":b.setFullYear(b.getFullYear()+d);break;case"mon":b.setMonth(b.getMonth()+d);break;case"wee":b.setDate(b.getDate()+7*d);break;case"day":b.setDate(b.getDate()+d);break;case"hou":b.setHours(b.getHours()+d);break;case"min":b.setMinutes(b.getMinutes()+d);break;case"sec":b.setSeconds(b.getSeconds()+d);break;default:var e;if("undefined"!=typeof(e=i.day[a[1].substring(0,3)])){var f=e-b.getDay();0==f?f=7*d:f>0?"last"==a[0]&&(f-=7):"next"==a[0]&&(f+=7),b.setDate(b.getDate()+f)}}break;default:if(!/\d+/.test(a[0]))return!1;switch(d*=parseInt(a[0],10),a[1].substring(0,3)){case"yea":b.setFullYear(b.getFullYear()+d);break;case"mon":b.setMonth(b.getMonth()+d);break;case"wee":b.setDate(b.getDate()+7*d);break;case"day":b.setDate(b.getDate()+d);break;case"hou":b.setHours(b.getHours()+d);break;case"min":b.setMinutes(b.getMinutes()+d);break;case"sec":b.setSeconds(b.getSeconds()+d)}}return!0};if(e=g.match(/^(\d{2,4}-\d{2}-\d{2})(?:\s(\d{1,2}:\d{2}(:\d{2})?)?(?:\.(\d+))?)?$/),null!=e){e[2]?e[3]||(e[2]+=":00"):e[2]="00:00:00",f=e[1].split(/-/g);for(d in i.mon)i.mon[d]==f[1]-1&&(f[1]=d);return f[0]=parseInt(f[0],10),f[0]=f[0]>=0&&f[0]<=69?"20"+(f[0]<10?"0"+f[0]:f[0]+""):f[0]>=70&&f[0]<=99?"19"+f[0]:f[0]+"",parseInt(this.strtotime(f[2]+" "+f[1]+" "+f[0]+" "+e[2])+(e[4]?e[4]/1e3:""),10)}var k="([+-]?\\d+\\s(years?|months?|weeks?|days?|hours?|min|minutes?|sec|seconds?|sun.?|sunday|mon.?|monday|tue.?|tuesday|wed.?|wednesday|thu.?|thursday|fri.?|friday|sat.?|saturday)|(last|next)\\s(years?|months?|weeks?|days?|hours?|min|minutes?|sec|seconds?|sun.?|sunday|mon.?|monday|tue.?|tuesday|wed.?|wednesday|thu.?|thursday|fri.?|friday|sat.?|saturday))(\\sago)?";if(e=g.match(new RegExp(k,"g")),null==e)return!1;for(d=0;d<e.length;d++)if(!j(e[d].split(" ")))return!1;return b.getTime()/1e3},bf.date.dateTime=function(a){return bf.date.format("Y-m-d H:i:s",a)},bf.date.unix=function(a){var b=new Date;return a?b.getTime():Math.round(b.getTime()/1e3)},bf.date.formatClock=function(a,b){return bf.date.zeroHour||(bf.date.zeroHour=bf.date.strtotime("2000-01-01 00:00:00")),bf.date.format(a,bf.date.zeroHour+parseInt(b))},bf.date.utcToUnix=function(a){var b=a.match(/^([0-9]{4})\-([0-9]{1,2})\-([0-9]{1,2})( ([0-9]{1,2}):([0-9]{1,2})(:([0-9]{1,2}))?)?/i);return Date.UTC(b[1],parseInt(b[2])-1,parseInt(b[3]),parseInt(b[5]),parseInt(b[6]),parseInt(b[8]))/1e3},bf.date.daySeconds=function(a){var b=a.match(/^([0-9]{1,2}):([0-9]{1,2}) ?([a-z]{2})/i);return b?(b[1]=bf.toInt(b[1]),b[2]=bf.toInt(b[2]),"pm"==b[3].toLowerCase()?12!=b[1]&&(b[1]+=12):12==b[1]&&(b[1]=0),3600*b[1]+60*b[2]):void 0},bf.date.times={year:31536e3,month:2592e3,day:86400,hour:3600,minute:60},bf.date.timeAgo=function(a,b,c){var d,e=bf.date.unix(),f=e-a;return c&&this.times[c]?d=f/this.times[c]:f>=this.times.year?(d=f/this.times.year,c="year"):f>=this.times.month?(d=f/this.times.month,c="month"):f>=this.times.day?(d=f/this.times.day,c="day"):f>=this.times.hour?(d=f/this.times.hour,c="hour"):f>=this.times.minute?(d=f/this.times.minute,c="minute"):(d=f,c="second"),d=bf.math.round(d,b),c=1==d?c:c+"s",d+" "+c},$(function(){if(bf.json){var a=bf.url.requestVar("_systemMessages");if(a){if(a=JSON.parse(a),bf.json.messages)for(var b in a)bf.json.messages.push(a[b]);else bf.json.messages=a;window.history.pushState({},"",bf.url.queryFilter("_systemMessages"))}bf.json.messages&&bf.view.sm.inserts(bf.json.messages)}if($("form").size()){var c=$("[data-addMessageContainers]");c.size()>0&&$("input, select, textarea",c).each(function(){$(this).after('<div class="_messageContainer" data-field="'+$(this).attr("name")+'"></div>')}),$("[data-dependee]").each(function(){var a=$(this).attr("data-dependee"),b=$(this).attr("name");$('[name="'+a+'"]').change(function(){bf.view.form.getOptions(b)}).change()})}if($(".sortContainer").size()){bf.sorts=[];var d=bf.url.requestVar("_sort");d?$(".sortContainer:not(.inlineSort)").attr("data-sort",d):d=$(".sortContainer:not(.inlineSort)").attr("data-sort"),d&&(bf.sorts=d.split(","),bf.view.ps.headerArrows()),$(".sortContainer:not(.inlineSort) *[data-field]").click(function(a){var b=$(this).attr("data-field");a.shiftKey?bf.view.ps.appendSort(b):bf.view.ps.changeSort(b),bf.view.ps.reload()})}$("*[data-help]").each(function(){var a,b,c=$(this),d=this.nodeName.toLowerCase();if("input"==d||"select"==d||"textarea"==d){var e=c.attr("name");b=$('*[data-fieldDisplay="'+e+'"]').eq(0),a="bottom"}else b=c,a="span"==d?"after":"bottom";var f=$('<span class="tooltipMarker">[?]</span>');f.attr("data-tooltip",c.attr("data-help")),"bottom"==a?f.appendTo(b):b.after(f)});var e=0;$("*[data-tooltip]").each(function(){var a=$(this);e+=1;var b=a.attr("id");b||(b="tooltipMarker-"+e,a.attr("id",b));var c=a.attr("data-tooltip");if("url:"==c.substr(0,4)){var d=c.substr(4);a.click(function(){bf.view.redirect(d,null,"tab")})}else{var f=$("<div/>",{html:c,"class":"tooltip",id:"tooltip-"+b}).prependTo("body");bf.view.closeButton(f,!0),a.click(function(a){var b=$(this),c=$("#tooltip-"+b.attr("id"));c.css(b.offset()),c.fadeIn({duration:"slow"}),c.click(function(a){a.stopPropagation()}),a.stopPropagation()})}}),$("body").click(function(){$(".tooltip").hide()})});